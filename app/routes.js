// Generated by CoffeeScript 1.3.3

module.exports = function(app) {
  var add_type, characters, die_on_error, fs, ftp, random_name;
  die_on_error = require('./util').die_on_error;
  add_type = require('./rest').add_type;
  fs = require('fs');
  ftp = require('ftp');
  characters = 'abcdefghijklmnopqrstuvwxyz0123456789';
  random_name = function(length) {
    var chars, i;
    chars = (function() {
      var _i, _results;
      _results = [];
      for (i = _i = 0; 0 <= length ? _i < length : _i > length; i = 0 <= length ? ++_i : --_i) {
        _results.push(characters[Math.floor(Math.random() * characters.length)]);
      }
      return _results;
    })();
    return chars.join('');
  };
  app.get('/add_video', function(req, res) {
    return res.render('add_video');
  });
  return app.post('/add_video', function(req, res) {
    return fs.readFile(req.files.video.path, function(err, data) {
      var client;
      client = new ftp();
      client.on('ready', function() {
        return client.put(data, "videos/" + (random_name(16)), die_on_error(res, function() {
          client.end();
          return res.send('okay');
        }));
      });
      client.on('error', function(err) {
        return res.send(err);
      });
      return client.connect({
        host: 'acsvolleyball.com',
        user: 'acsvolleyball',
        password: 'Voll3yball'
      });
    });
  });
};
